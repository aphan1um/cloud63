- hosts: localhost
  vars_files:
    - host_vars/nectar.yaml
  gather_facts: true

  roles:
    # prereq
    - role: os-common
    #- role: os-find-images
    # prepare for instance creation
    - role: os-create-volumes
    - role: os-create-security-groups
    # now create instances
    - role: os-create-instance
    #- role: os-create-volume-snapshots

- hosts: vms
  remote_user: ubuntu
  become: yes
  gather_facts: yes
  vars:
    ansible_ssh_private_key_file: "./private_key_aphan1.pem"
    couchDB_mount_point: "./couchDB_Data"
  roles:
    - role: vm-set-proxy
    - role: vm-mount-volumes
      vars:
        mounts:
          - device: "/dev/vdb"
            path: "{{ couchDB_mount_point }}"
    - role: vm-install-python
    - role: vm-install-docker
    - role: vm-init-couchdb
    - role: main-start-twitter-script